<h2>Decision Knowledge Extraction from Git</h2>

<div class="field-group">
    <label for="isKnowledgeExtractedFromGit-toggle">Extract from Git?</label>
    <aui-toggle id="isKnowledgeExtractedFromGit-toggle"
                value="$projectKey" label="Extract from	Git?"></aui-toggle>
    <div class="description">Enables or disables whether decision
        knowledge is extracted from git for this project.
    </div>
</div>

<div class="field-group">
    <label for="isPostFeatureBranchCommitsActivated-toggle">Post singular feature branch commit messages as
        comment?</label>
    <aui-toggle id="isPostFeatureBranchCommitsActivated-toggle"
                value="$projectKey" label="Post feature branch commits?"></aui-toggle>
    <div class="description">Enables or disables whether singular feature branch commit messages are posted
        as comment under the corresponding issue for this project.
    </div>
</div>

<div class="field-group">
    <label for="isPostSquashedCommitsActivated-toggle">Post squashed commit messages as comment?</label>
    <aui-toggle id="isPostSquashedCommitsActivated-toggle"
                value="$projectKey" label="Post squashed commits?"></aui-toggle>
    <div class="description">Enables or disables whether squashed commit messages are posted
        as comment under the corresponding issue for this project.

    </div>
</div>

<div class="field-group">
    <label for="git-uri-input-field">Git Repository</label>
    <input id="git-uri-input-field" type="text" class="text long-field"
           value="$project.getGitUri()" placeholder="https://github.com/cures-hub/cures-condec-jira.git"/>
    <input type="button"
           id="git-uri-button" class="aui-button aui-button-primary" value="Save Address"/>
    <div class="description">Uniform resource identifier of the git repository that will be cloned.</div>
</div>


<script>
    var gitToggle = document.getElementById("isKnowledgeExtractedFromGit-toggle");
    var gitSubmitButton = document.getElementById("git-uri-button");
    var isPostSquashedCommitsActivatedToggle = document.getElementById('isPostSquashedCommitsActivated-toggle');
    var isPostFeatureBranchCommitsActivatedToggle = document.getElementById('isPostFeatureBranchCommitsActivated-toggle');

    if ($project.isKnowledgeExtractedFromGit()) {
        gitToggle.checked = true;
    } else {
        gitToggle.checked = false;
        isPostSquashedCommitsActivatedToggle.disabled = true;
        isPostFeatureBranchCommitsActivatedToggle.disabled = true;
    }


    if ($project.isPostSquashedCommitsActivated()) {
        isPostSquashedCommitsActivatedToggle.checked = true;
    } else {
        isPostSquashedCommitsActivatedToggle.checked = false;
    }

    if ($project.isPostFeatureBranchCommitsActivated()
    )
    {
        isPostFeatureBranchCommitsActivatedToggle.checked = true;
    }
    else
    {
        isPostFeatureBranchCommitsActivatedToggle.checked = false;
    }


    isPostSquashedCommitsActivatedToggle.addEventListener('change', function (event) {
        this.busy = true;
        conDecAPI.setPostSquashedCommits(this.checked, this.value);
        this.busy = false;
    });

    isPostFeatureBranchCommitsActivatedToggle.addEventListener('change', function (event) {
        this.busy = true;
        conDecAPI.setPostFeatureBranchCommits(this.checked, this.value);
        this.busy = false;
    });


    gitSubmitButton.addEventListener("click", function () {
        var gitUri = document.getElementById("git-uri-input-field").value;
        conDecAPI.setGitUri("$projectKey", gitUri);
        window.onbeforeunload = null;
    });

    gitToggle.addEventListener("change", function (error) {
        this.busy = true;
        conDecAPI.setKnowledgeExtractedFromGit(this.checked, this.value);
        isPostSquashedCommitsActivatedToggle.disabled = !this.checked;
        isPostFeatureBranchCommitsActivatedToggle.disabled = !this.checked;
        if(!this.checked){
            isPostSquashedCommitsActivatedToggle.checked = false;
            isPostFeatureBranchCommitsActivatedToggle.checked = false;
        }
        this.busy = false;
    });
</script>