<h2>Decision Knowledge Extraction from Git</h2>

<div class="field-group">
    <label for="isKnowledgeExtractedFromGit-toggle">Extract from Git?</label>
    <aui-toggle id="isKnowledgeExtractedFromGit-toggle"
                value="$projectKey" label="Extract from	Git?"></aui-toggle>
    <div class="description">Enables or disables whether decision
        knowledge is extracted from git for this project.
    </div>
</div>

<div class="field-group">
    <label for="isPostFeatureBranchCommitsActivated-toggle">Post singular feature branch commit messages as
        comment?</label>
    <aui-toggle id="isPostFeatureBranchCommitsActivated-toggle"
                value="$projectKey" label="Post feature branch commits?"></aui-toggle>
    <div class="description">Enables or disables whether singular feature branch commit messages are posted
        as comment under the corresponding issue for this project.
    </div>
</div>

<div class="field-group">
    <label for="isPostSquashedCommitsActivated-toggle">Post squashed commit messages as comment?</label>
    <aui-toggle id="isPostSquashedCommitsActivated-toggle"
                value="$projectKey" label="Post squashed commits?"></aui-toggle>
    <div class="description">Enables or disables whether squashed commit messages are posted
        as comment under the corresponding issue for this project.

    </div>
</div>
<!--
<div class="field-group">
    <label for="git-uri-input-field">Git Repository</label>
    <input id="git-uri-input-field" type="text" class="text long-field"
           value="$project.getGitUri()" placeholder="https://github.com/cures-hub/cures-condec-jira.git"/>
    <input type="button"
           id="git-uri-button" class="aui-button aui-button-primary" value="Save Address"/>
    <div class="description">Uniform resource identifier of the git repository that will be cloned (Example: https://github.com/cures-hub/cures-condec-jira.git).</div>
</div>
-->
<div class="field-group">
	<label for="git-uri-input-field">Git Repositories</label>
	<div class="description">Uniform resource identifier of the git repository that will be cloned (Example: https://github.com/cures-hub/cures-condec-jira.git).</div>
	<div class="container1">
	    #foreach($string in $project.getGitUris())
	    	<div><input type="text" class="text long-field" value="$string"></div>    
	    #end
	    <button class="add_form_field" >Add New Repository &nbsp; 
	    	<span style="font-size:16px; font-weight:bold;">+ </span>
	    </button>
		<input type="button" id="git-uris-button" class="aui-button aui-button-primary" value="Save Addresses"/>
	</div>
</div>

<script>
$(document).ready(function() {
    var max_fields = 10;
    var wrapper = $(".container1");
    var add_button = $(".add_form_field");

    var x = 1;
    $(add_button).click(function(e) {
        e.preventDefault();
        if (x < max_fields) {
            x++;
            $(wrapper).append('<div><input type="text" name="mytext[]" class="text long-field"/><a href="#" class="delete">Delete</a></div>'); //add input box
        } else {
            alert('You Reached the limits')
        }
    });

    $(wrapper).on("click", ".delete", function(e) {
        e.preventDefault();
        $(this).parent('div').remove();
        x--;
    })
});

	var gitsSubmitButton = document.getElementById("git-uris-button");

    gitsSubmitButton.addEventListener("click", function () {
        var gitUris = document.getElementsByClassName("text long-field");
        var uristring = "";
        for (i = 0; i < gitUris.length; i++) {
        	if(i==0){
    			uristring = gitUris[i].value;
    		}else{
    			uristring = uristring + ";;" +gitUris[i].value;    			
    		}
		}
        conDecAPI.setGitUris("$projectKey", uristring);
        window.onbeforeunload = null;
    });
</script>

<script>
    var gitToggle = document.getElementById("isKnowledgeExtractedFromGit-toggle");
    var isPostSquashedCommitsActivatedToggle = document.getElementById('isPostSquashedCommitsActivated-toggle');
    var isPostFeatureBranchCommitsActivatedToggle = document.getElementById('isPostFeatureBranchCommitsActivated-toggle');

    if ($project.isKnowledgeExtractedFromGit()) {
        gitToggle.checked = true;
    } else {
        gitToggle.checked = false;
        isPostSquashedCommitsActivatedToggle.disabled = true;
        isPostFeatureBranchCommitsActivatedToggle.disabled = true;
    }


    if ($project.isPostSquashedCommitsActivated()) {
        isPostSquashedCommitsActivatedToggle.checked = true;
    } else {
        isPostSquashedCommitsActivatedToggle.checked = false;
    }

    if ($project.isPostFeatureBranchCommitsActivated()
    )
    {
        isPostFeatureBranchCommitsActivatedToggle.checked = true;
    }
    else
    {
        isPostFeatureBranchCommitsActivatedToggle.checked = false;
    }


    isPostSquashedCommitsActivatedToggle.addEventListener('change', function (event) {
        this.busy = true;
        conDecAPI.setPostSquashedCommits(this.checked, this.value);
        this.busy = false;
    });

    isPostFeatureBranchCommitsActivatedToggle.addEventListener('change', function (event) {
        this.busy = true;
        conDecAPI.setPostFeatureBranchCommits(this.checked, this.value);
        this.busy = false;
    });


    gitToggle.addEventListener("change", function (error) {
        this.busy = true;
        conDecAPI.setKnowledgeExtractedFromGit(this.checked, this.value);
        isPostSquashedCommitsActivatedToggle.disabled = !this.checked;
        isPostFeatureBranchCommitsActivatedToggle.disabled = !this.checked;
        if(!this.checked){
            isPostSquashedCommitsActivatedToggle.checked = false;
            isPostFeatureBranchCommitsActivatedToggle.checked = false;
        }
        this.busy = false;
    });
</script>