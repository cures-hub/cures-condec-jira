<h4>Settings for the duplication detection</h4>

<div class="field-group top-label">
    <label for="min-length-duplicate">Minimum length of similar text for duplication detection</label>
    <input class="text short-field"
           type="number"
           data-aui-validation-field
           value="$minLengthDuplicate"

           step="1" min="3"
           id="min-length-duplicate"
           name="min-length-duplicate">
    <button id="save-min-length-duplicate-btn" class='aui-button aui-button-primary aui-button-compact'>
        Save
    </button>

</div>


<script>
    const saveMinLengthDuplicateBtn = document.getElementById("save-min-length-duplicate-btn");
    const minLengthDuplicateInput = document.getElementById("min-length-duplicate");

    const saveMinLengthDuplicate = (event) => {
        event.preventDefault();
        event.stopPropagation();
        window.onbeforeunload = null;
        if (!saveMinLengthDuplicateBtn.isBusy()) {
            console.log(minLengthDuplicateInput.value);
            saveMinLengthDuplicateBtn.setAttribute('aria-disabled', 'true');
            saveMinLengthDuplicateBtn.busy();

            configAPI.setMinimumDuplicateLength(conDecAPI.getProjectKey(), minLengthDuplicateInput.value)
                .then(() => conDecAPI.showFlag("success", "Configuration successfully updated!"))
                .catch(() => conDecAPI.showFlag("error", "An error occurred while updating the configuration!"))
            .finally(() => {
                saveMinLengthDuplicateBtn.setAttribute('aria-disabled', 'false');
                saveMinLengthDuplicateBtn.idle();
            })

        }

    }

    // Issue: When emitting the event the page is reloaded.
    // Solution: Get click event and stop default behavior as well as propagation.
    saveMinLengthDuplicateBtn.addEventListener('click', event => saveMinLengthDuplicate(event));


</script>