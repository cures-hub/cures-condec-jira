<h2>Release Notes</h2>
<h3>Default Jira Issue Type Mapping</h3>
#set($releaseNotesConfig = $project.getReleaseNotesConfiguration())

<div class="field-group">
    <label for="select-issue-type-new_features">New features</label>
    <select class="multi-select" size="8" multiple="multiple" id="select-issue-type-new_features" name="select-issue-type-new_features">
		#foreach ($issueType in $project.getJiraIssueTypeNames())
            <option name="$issueType"
				#if ( $releaseNotesConfig.getJiraIssueTypesForNewFeatures().contains($issueType) )
                    selected
				#end
            >
				$issueType</option>
		#end
    </select>
    <div class="description">Selects the Jira issue types which should be considered as "new feature".</div>
</div>
    
<div class="field-group">
    <label for="select-issue-type-bug_fixes">Bug fixes</label>
    <select class="multi-select" size="8" multiple="multiple" id="select-issue-type-bug_fixes" name="select-issue-type-bug_fixes">
		#foreach ($issueType in $project.getJiraIssueTypeNames())
            <option name="$issueType"
				#if ( $releaseNotesConfig.getJiraIssueTypesForBugFixes().contains($issueType) )
                    selected
				#end
            >
				$issueType</option>
		#end
    </select>
    <div class="description">Selects the Jira issue types which should be considered as "bug fixes".</div>
</div>
    
<div class="field-group">
    <label for="select-issue-type-improvements">Improvements</label>
    <select class="multi-select" size="8" multiple="multiple" id="select-issue-type-improvements" name="select-issue-type-improvements">
		#foreach ($issueType in $project.getJiraIssueTypeNames())
            <option name="$issueType"
				#if ( $releaseNotesConfig.getJiraIssueTypesForImprovements().contains($issueType) )
                    selected
				#end
            >
				$issueType</option>
		#end
    </select>
    <div class="description">Selects the Jira issue types which should be considered as "improvements".</div>
</div>
<input type="button" id="save-release-notes-configuration" 
	value="Save release notes configuration" class="aui-button aui-button-primary"/>

<script>		
	var saveReleaseNotesConfigButton = document.getElementById("save-release-notes-configuration");
	saveReleaseNotesConfigButton.addEventListener("click", function () {
		var releaseNotesConfig = {
			"jiraIssueTypesForImprovements" : getSelectedValues("improvements"),
			"jiraIssueTypesForBugFixes" : getSelectedValues("bug_fixes"),
			"jiraIssueTypesForNewFeatures" : getSelectedValues("new_features")
		}
        conDecReleaseNotesAPI.saveReleaseNotesConfiguration("$projectKey", releaseNotesConfig);
    });
    
	function getSelectedValues(type) {
		var x = document.getElementById("select-issue-type-" + type);
		var selectedItems = [];
        for (var i = 0; i < x.options.length; i++) {
        	if (x.options[i].selected == true) {
        		selectedItems.push(x.options[i].value)
        	}
        }
        return selectedItems;
	}
</script>        