(function(global) {

	var ConDecDecisionGroups = function ConDecDecisionGroups() {
	};

	ConDecDecisionGroups.prototype.initView = function() {
		console.log("ConDecDecisionGroups initView");

		conDecFiltering.fillFilterElements("decision-groups", ["Decision", "Solution"]);
		conDecFiltering.addOnClickEventToFilterButton("decision-groups", () => conDecDecisionGroups.updateView());

		// conDecObservable.subscribe(this);
		this.updateView();
	};

	ConDecDecisionGroups.prototype.buildMatrix = function() {
		const body = document.getElementById("group-table-body");
		var knowledgeTypesWithoutCode = conDecAPI.getKnowledgeTypes();
		var index = knowledgeTypesWithoutCode.indexOf("Code");
		knowledgeTypesWithoutCode.splice(index, 1);

		var filterSettings = conDecFiltering.getFilterSettings("decision-groups");
		filterSettings["projectKey"] = conDecAPI.projectKey;
		conDecGroupingAPI.getDecisionGroupsMap(filterSettings, function(error, decisionGroupsMap) {
			for (var [group, elements] of decisionGroupsMap.entries()) {
				newTableRow(body, group, elements);
			}
		});
	};

	ConDecDecisionGroups.prototype.updateView = function() {
		const body = document.getElementById("group-table-body");
		body.innerHTML = "";
		this.buildMatrix();
	};

	function newTableRow(body, groupName, elements) {
		const row = document.createElement("tr");
		const tableRowElement = document.createElement("td");
		tableRowElement.innerHTML = groupName;
		tableRowElement.addEventListener("contextmenu", function(e) {
			e.preventDefault();
			conDecContextMenu.createContextMenu(groupName, "groups", e, null);
		}, false);
		row.appendChild(tableRowElement);

		const tableRowElement2 = document.createElement("td");
		tableRowElement2.innerHTML = elements.length;
		row.appendChild(tableRowElement2);

		const tableRowElement3 = document.createElement("td");
		for (element of elements) {
			var link = conDecAPI.createLinkToElement(element);
			link.element = element;
			link.addEventListener("contextmenu", function(event) {
				event.preventDefault();
				conDecContextMenu.createContextMenu(this.element.id, this.element.documentationLocation, event);
			});
			tableRowElement3.appendChild(link);
		}
		row.appendChild(tableRowElement3);
		body.appendChild(row);
	}

	global.conDecDecisionGroups = new ConDecDecisionGroups();
})(window);